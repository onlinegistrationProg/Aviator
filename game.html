<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Aviator Game</title>
<style>
body{margin:0;font-family:Arial,sans-serif;background:#0D0D0F;color:#fff;overflow:hidden;}
#aviatorCanvas{display:block;width:100vw;height:100vh;background:#0D0D0F;}
#controls{position:absolute;bottom:20px;width:100%;display:flex;justify-content:space-between;padding:0 20px;}
button{padding:10px 20px;border:none;border-radius:5px;cursor:pointer;}
#depositBtn{background:#28a745;color:#fff;}
#stakeBtn{background:#007bff;color:#fff;}
#results{position:absolute;bottom:80px;right:20px;background:rgba(0,0,0,0.6);padding:10px;border-radius:5px;max-width:200px;font-size:14px;}
#balance{position:absolute;top:20px;right:20px;background:rgba(0,0,0,0.6);padding:10px;border-radius:5px;font-size:16px;}
#pendingDeposits{position:absolute;top:60px;right:20px;background:rgba(255,255,0,0.6);padding:10px;border-radius:5px;font-size:14px;}
</style>
</head>
<body>
<canvas id="aviatorCanvas"></canvas>
<div id="balance">Balance: <span id="balAmount">0</span></div>
<div id="pendingDeposits">Pending Deposits: <span id="pendingAmount">0</span></div>
<div id="controls">
<button id="depositBtn" onclick="requestDeposit()">Deposit</button>
<button id="stakeBtn" onclick="stake()">Stake</button>
</div>
<div id="results"><strong>Last 5 results:</strong><ul id="lastResults"></ul></div>

<script>
// ----- Balance & Stakes -----
let balance=0,pendingDeposits=0,stakes=[],lastResults=[];

// ----- Aviator -----
const canvas=document.getElementById('aviatorCanvas');const ctx=canvas.getContext('2d');canvas.width=window.innerWidth;canvas.height=window.innerHeight;
let aviatorY=canvas.height-50,aviatorSpeed=2,currentMultiplier=1.0;

// ----- Future Multipliers -----
let futureMultipliers=JSON.parse(localStorage.getItem('futureMultipliers'))||[];
function getNextMultiplier(){
  let now=new Date();
  let timeStr=now.getHours().toString().padStart(2,'0')+":"+now.getMinutes().toString().padStart(2,'0')+":"+now.getSeconds().toString().padStart(2,'0');
  for(let i=0;i<futureMultipliers.length;i++){if(futureMultipliers[i].time>=timeStr) return futureMultipliers[i].multiplier;}
  return +(Math.random()*5+1).toFixed(2);
}
let bustMultiplier=getNextMultiplier();

// ----- Draw / Update -----
function drawAviator(){ctx.clearRect(0,0,canvas.width,canvas.height);ctx.fillStyle='#ff0033';ctx.beginPath();ctx.arc(canvas.width/2,aviatorY,20,0,Math.PI*2);ctx.fill();ctx.fillStyle='#00ff00';ctx.font="20px Arial";ctx.fillText(currentMultiplier.toFixed(2)+"×",canvas.width/2-20,aviatorY-30);}
function updateAviator(){aviatorY-=aviatorSpeed;currentMultiplier+=0.01;
if(currentMultiplier.toFixed(2)>=bustMultiplier){lastResults.push(bustMultiplier.toFixed(2)+"×");if(lastResults.length>5) lastResults.shift();updateLastResults();
aviatorY=canvas.height-50;currentMultiplier=1.0;bustMultiplier=getNextMultiplier();stakes.forEach(s=>s.active=false);}
stakes.forEach(s=>{if(s.active&&currentMultiplier.toFixed(2)>=s.cashoutMultiplier){balance+=s.amount*s.cashoutMultiplier;s.active=false;updateBalance();}});
drawAviator();requestAnimationFrame(updateAviator);}
function updateBalance(){document.getElementById('balAmount').textContent=balance.toFixed(2);}
function updatePendingDeposits(){document.getElementById('pendingAmount').textContent=pendingDeposits.toFixed(2);}
function updateLastResults(){const ul=document.getElementById('lastResults');ul.innerHTML="";lastResults.forEach(r=>{const li=document.createElement('li');li.textContent=r;ul.appendChild(li);});}

// ----- Deposit & Stake -----
function requestDeposit(){let amount=parseFloat(prompt("Enter deposit amount:"));if(amount&&amount>0){pendingDeposits+=amount;updatePendingDeposits();
let deposits=JSON.parse(localStorage.getItem('pendingDeposits'))||[];deposits.push({amount:amount,user:localStorage.getItem('loggedInUser')||"Player"});localStorage.setItem('pendingDeposits',JSON.stringify(deposits));
alert("Deposit request sent for admin approval.");}}
function stake(){let amount=parseFloat(prompt("Enter stake amount:"));if(amount&&amount>0&&amount<=balance){balance-=amount;updateBalance();stakes.push({amount:amount,active:true,cashoutMultiplier:bustMultiplier});alert("Staked "+amount+" for this round!");}else{alert("Invalid stake or insufficient balance!");}}

// ----- Listen for approved deposits -----
setInterval(()=>{
  let approved=JSON.parse(localStorage.getItem('approvedDeposits'))||[];
  approved.forEach(d=>{if(d.user===(localStorage.getItem('loggedInUser')||"Player")){balance+=d.amount;pendingDeposits-=d.amount;}});
  localStorage.setItem('approvedDeposits',JSON.stringify(approved.filter(d=>d.user!==(localStorage.getItem('loggedInUser')||"Player"))));
  updateBalance(); updatePendingDeposits();
},1000);

// ----- Start -----
updateAviator();
</script>
</body>
</html>
