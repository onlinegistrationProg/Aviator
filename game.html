<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Aviator Game</title>
<style>
body { margin:0; font-family: Arial, sans-serif; background:#0d0d0f; color:#fff;}
header{background:#111; padding:10px; text-align:center; color:#ff0033; font-size:24px;}
.container{padding:20px;}
button{padding:10px 20px; margin:5px; border:none; border-radius:5px; cursor:pointer;}
#stakeBtn{background:#ff0033; color:#fff;}
#cashoutBtn{background:#00ff33; color:#000;}
.balance{margin:10px 0; font-size:18px;}
.deposit{background:#111; color:#ff0033; padding:10px; border:1px solid #ff0033; cursor:pointer; margin-top:10px; border-radius:5px;}
.multiplier{font-size:48px; color:#ff0033; text-align:center; margin:20px 0;}
.message{margin:10px 0; color:#00ff33; text-align:center;}
</style>
</head>
<body>
<header>Aviator</header>
<div class="container">
  <div class="balance">Balance: <span id="balance">0</span> coins</div>
  <input type="number" id="stake" placeholder="Enter stake amount" min="1">
  <button id="stakeBtn" onclick="startRound()">Stake</button>
  <button id="cashoutBtn" onclick="cashout()" disabled>Cashout</button>
  <div class="multiplier" id="multiplier">×1.00</div>
  <div class="message" id="message"></div>
  <button class="deposit" onclick="requestDeposit()">Request Deposit</button>
  <button style="margin-top:20px;" onclick="logout()">Logout</button>
</div>

<script>
let player = JSON.parse(localStorage.getItem("currentPlayer"));
document.getElementById("balance").textContent = player.balance;
let interval, multiplier=1, staking=false, stakeAmount=0;

// Daily rounds storage
let rounds = JSON.parse(localStorage.getItem("dailyRounds") || "[]");
let roundIndex = rounds.length;

function generateRound() {
  const crash = +(Math.random()*50 + 1).toFixed(2); // 1.00 - 50.00
  const startTime = new Date().toLocaleTimeString();
  let round = { round: roundIndex+1, crash, startTime, stakes: [] };
  rounds.push(round);
  localStorage.setItem("dailyRounds", JSON.stringify(rounds));
  return round;
}

function startRound() {
  stakeAmount = Number(document.getElementById("stake").value);
  if(stakeAmount <= 0 || stakeAmount > player.balance) { alert("Invalid stake"); return; }
  staking = true;
  document.getElementById("stakeBtn").disabled = true;
  document.getElementById("cashoutBtn").disabled = false;
  multiplier = 1;
  document.getElementById("multiplier").textContent = `×${multiplier.toFixed(2)}`;
  document.getElementById("message").textContent = "Game started...";
  
  // Generate or get current round
  let round = rounds[roundIndex] || generateRound();
  round.stakes.push({ phone: player.phone, amount: stakeAmount, cashedOut: false });
  localStorage.setItem("dailyRounds", JSON.stringify(rounds));

  interval = setInterval(() => updateMultiplier(round), 100);
}

function updateMultiplier(round) {
  multiplier += Math.random()*0.05;
  document.getElementById("multiplier").textContent = `×${multiplier.toFixed(2)}`;
  if(multiplier >= round.crash) endRound(false, round);
}

function cashout() {
  if(!staking) return;
  let winnings = stakeAmount * multiplier;
  player.balance += winnings - stakeAmount;
  updatePlayer();
  endRound(true, null, multiplier);
}

function endRound(cashedOut, round=null, cashedMultiplier=0) {
  clearInterval(interval);
  staking=false;
  document.getElementById("stakeBtn").disabled = false;
  document.getElementById("cashoutBtn").disabled = true;

  if(cashedOut) {
    document.getElementById("message").textContent = `You cashed out: ${ (stakeAmount*cashedMultiplier).toFixed(2) } coins!`;
  } else {
    player.balance -= stakeAmount;
    updatePlayer();
    document.getElementById("message").textContent = `Crashed at ×${round.crash}! You lost your stake.`;
  }
  document.getElementById("balance").textContent = player.balance.toFixed(2);
  roundIndex++;
  if(round && !cashedOut) {
    // mark stakes lost
    round.stakes.forEach(s => { if(s.phone===player.phone) s.cashedOut=false; });
    localStorage.setItem("dailyRounds", JSON.stringify(rounds));
  }
}

function updatePlayer() {
  let players = JSON.parse(localStorage.getItem("players"));
  let index = players.findIndex(p => p.phone === player.phone);
  players[index] = player;
  localStorage.setItem("players", JSON.stringify(players));
  localStorage.setItem("currentPlayer", JSON.stringify(player));
}

function requestDeposit() {
  let amount = prompt("Enter deposit amount:");
  if(!amount || amount <=0) return;
  let deposits = JSON.parse(localStorage.getItem("deposits") || "[]");
  deposits.push({ phone: player.phone, amount:Number(amount), status:"pending" });
  localStorage.setItem("deposits", JSON.stringify(deposits));
  alert("Deposit request sent. Wait for admin approval.");
}

function logout() {
  localStorage.removeItem("loggedIn");
  localStorage.removeItem("currentPlayer");
  window.location.href="index.html";
}
</script>
</body>
</html>
