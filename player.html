<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Aviator — Player</title>
<style>
  body {margin:0;background:#0d0d0f;color:#fff;font-family:Arial,Helvetica,sans-serif}
  .wrap{max-width:900px;margin:14px auto;padding:12px}
  h2{color:#ff3344}
  .panel{background:#111;padding:12px;border-radius:10px;margin-top:12px}
  input, button {padding:8px;border-radius:6px;border:none;margin:4px 0;width:100%;}
  button {cursor:pointer;color:#fff;}
  .green{background:#25b24a;}
  .red{background:#ff5555;}
  #cashOut {display:none;}
</style>
</head>
<body>
<div class="wrap">
  <h2>Aviator — Player</h2>

  <!-- LOGIN / REGISTER -->
  <div class="panel" id="loginPanel">
    <input type="text" id="phone" placeholder="Phone Number" autocomplete="tel">
    <input type="password" id="password" placeholder="Password" autocomplete="current-password">
    <input type="password" id="confirm" placeholder="Confirm Password" autocomplete="new-password">
    <button id="loginBtn">Login / Register</button>
  </div>

  <!-- PLAYER PANEL -->
  <div class="panel" id="playerPanel" style="display:none;">
    <h3>Balance: <span id="balance">0</span></h3>

    <!-- Deposit Request -->
    <div class="panel">
      <h4>Deposit Request</h4>
      <input type="number" id="depAmount" placeholder="Amount">
      <button id="requestDep">Request Deposit</button>
    </div>

    <!-- Stake / Round -->
    <div class="panel">
      <h4>Stake / Round</h4>
      <input type="number" id="stakeAmount" placeholder="Stake Amount">
      <button id="startRound">Start Round</button>
      <button id="cashOut">Cash Out</button>
      <p>Current Multiplier: <span id="multiplier">1.00x</span></p>
    </div>

    <!-- Past Multipliers -->
    <div class="panel">
      <h4>Past Multipliers</h4>
      <ul id="pastRounds"></ul>
    </div>

    <button id="logoutBtn" class="red">Logout</button>
  </div>
</div>

<script>
let currentUser = null;
let roundInterval = null;
let currentMultiplier = 1;
let stakedAmount = 0;

// UTILITIES
function saveUsers(users){ localStorage.setItem('aviator_users', JSON.stringify(users)) }
function getUsers(){ return JSON.parse(localStorage.getItem('aviator_users')||'{}') }
function saveRounds(rounds){ localStorage.setItem('aviator_rounds_'+new Date().toISOString().slice(0,10), JSON.stringify(rounds)) }
function getRounds(){ return JSON.parse(localStorage.getItem('aviator_rounds_'+new Date().toISOString().slice(0,10))||'[]') }

// LOGIN / REGISTER
document.getElementById('loginBtn').addEventListener('click', ()=>{
  const phone = document.getElementById('phone').value.trim();
  const pass = document.getElementById('password').value;
  const confirm = document.getElementById('confirm').value;
  if(!phone || !pass) return alert('Enter phone and password');
  const users = getUsers();
  if(!users[phone]){
    if(!confirm) return alert('Confirm password for registration');
    if(pass !== confirm) return alert('Passwords do not match');
    users[phone] = {password: pass, balance:0};
    saveUsers(users);
  } else {
    if(users[phone].password !== pass) return alert('Incorrect password');
  }
  currentUser = phone;
  localStorage.setItem('aviator_last_user', currentUser);
  document.getElementById('loginPanel').style.display='none';
  document.getElementById('playerPanel').style.display='block';
  updateBalance();
  loadPastRounds();
});

// LOGOUT
document.getElementById('logoutBtn').addEventListener('click', ()=>{
  currentUser = null;
  document.getElementById('playerPanel').style.display='none';
  document.getElementById('loginPanel').style.display='block';
  document.getElementById('password').value='';
  document.getElementById('confirm').value='';
});

// UPDATE BALANCE
function updateBalance(){
  const users = getUsers();
  document.getElementById('balance').textContent = users[currentUser]?.balance || 0;
}

// DEPOSIT REQUEST
document.getElementById('requestDep').addEventListener('click', ()=>{
  const amt = Number(document.getElementById('depAmount').value);
  if(!amt || amt<=0) return alert('Enter valid amount');
  const dep = JSON.parse(localStorage.getItem('aviator_deposits') || '[]');
  dep.push({phone: currentUser, amount: amt, note:'player request'});
  localStorage.setItem('aviator_deposits', JSON.stringify(dep));
  alert('Deposit requested. Admin approval required.');
  document.getElementById('depAmount').value='';
});

// ROUND / STAKING
document.getElementById('startRound').addEventListener('click', ()=>{
  const stake = Number(document.getElementById('stakeAmount').value);
  const users = getUsers();
  if(!stake || stake <=0 || stake > (users[currentUser].balance || 0)) return alert('Invalid stake');
  stakedAmount = stake;
  users[currentUser].balance -= stake;
  saveUsers(users);
  updateBalance();
  currentMultiplier = 1;
  document.getElementById('cashOut').style.display='inline-block';

  const rounds = getRounds();
  let roundIndex = 0;

  roundInterval = setInterval(()=>{
    if(roundIndex < rounds.length){
      currentMultiplier = rounds[roundIndex];
      roundIndex++;
    } else {
      const incr = 0.01 + Math.random()*0.05;
      currentMultiplier = parseFloat((currentMultiplier + incr).toFixed(2));
      rounds.push(currentMultiplier);
      saveRounds(rounds);
    }
    document.getElementById('multiplier').textContent = currentMultiplier+'x';
    // random bust check at last multiplier
    if(roundIndex===rounds.length && Math.random() < 0.01){
      clearInterval(roundInterval);
      alert('BUST! You lost your stake.');
      stakedAmount = 0;
      document.getElementById('cashOut').style.display='none';
      loadPastRounds(currentMultiplier);
    }
  }, 200);
});

// CASH OUT
document.getElementById('cashOut').addEventListener('click', ()=>{
  clearInterval(roundInterval);
  const win = parseFloat((stakedAmount * currentMultiplier).toFixed(2));
  const users = getUsers();
  users[currentUser].balance += win;
  saveUsers(users);
  alert('Cashed out: '+win);
  stakedAmount = 0;
  currentMultiplier = 1;
  document.getElementById('multiplier').textContent='1.00x';
  document.getElementById('cashOut').style.display='none';
  updateBalance();
  loadPastRounds();
});

// LOAD PAST MULTIPLIERS
function loadPastRounds(lastMultiplier){
  const ul = document.getElementById('pastRounds');
  ul.innerHTML='';
  const rounds = getRounds();
  if(lastMultiplier) rounds.push(lastMultiplier);
  rounds.forEach(r=>{
    if(r){
      const li = document.createElement('li');
      li.textContent = r.toFixed(2)+'x';
      ul.appendChild(li);
    }
  });
  saveRounds(rounds);
}

// INITIALIZATION: autofill last user
window.addEventListener('load', ()=>{
  const users = getUsers();
  const lastPhone = localStorage.getItem('aviator_last_user');
  if(lastPhone && users[lastPhone]){
    document.getElementById('phone').value = lastPhone;
    document.getElementById('password').value = users[lastPhone].password;
  }
});
</script>
</body>
</html>
